<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>vue3.x 新特性 xianxin 志强网</title><meta name="keywords" content="css,vue"><meta name="description" content="志强博客"><link rel="shortcut icon" type="image/x-icon" href="/img/favicon.ico"><link rel="stylesheet" href="/css/blog.css"><link rel="stylesheet" href="/libs/layui/css/layui.css"><script src="/libs/layui/layui.js"></script><script src="/js/blog.js"></script><meta name="generator" content="Hexo 7.3.0"></head><body class="lay-blog"><div class="header"><div class="header-wrap"><h1 class="logo pull-left"><a href="/"><img src="/img/logo.png" alt="" class="logo-img"> <img src="/img/logo-text.png" alt="" class="logo-text"></a></h1><form class="layui-form blog-seach pull-left" method="get" action="https://www.google.com/search?"><div class="layui-form-item blog-sewrap"><div class="layui-input-block blog-sebox"><i class="layui-icon layui-icon-search"></i> <input type="text" name="q" lay-verify="title" autocomplete="off" class="layui-input"> <input type="hidden" name="source" value="https://www.zhiqiang.wang"></div></div></form><div class="blog-nav pull-right"><ul class="layui-nav pull-left"><li class="layui-nav-item"><a href="/">Home</a></li><li class="layui-nav-item"><a href="/about">About</a></li><li class="layui-nav-item"><a href="/archives">Archives</a></li><li class="layui-nav-item"><a href="/tags">Tags</a></li><li class="layui-nav-item"><a href="/sitemap.xml">RSS</a></li></ul></div></div></div><div class="container-wrap"><div class="container"><div class="contar-wrap"><div class="item"><div class="item-box"><p class="layui-breadcrumb" style="visibility:inherit"><a href="/">首页 </a><a href="/categories/%E5%89%8D%E7%AB%AF/">前端</a></p><h3>vue3.x 新特性</h3><h5>发布于：<span> 2020-06-18</span></h5><div class="post-meta"><a href="/tags/css/"><button type="button" class="layui-btn layui-btn-sm layui-bg-orange">#css</button> </a><a href="/tags/vue/"><button type="button" class="layui-btn layui-btn-sm layui-bg-orange">#vue</button></a></div><hr class="layui-border-orange"><div class="layui-content"><p class="lay-content page-content"></p><blockquote><p>本文主要围绕 <code>vue-compisition-api</code>，来讲解大家最关心的、同时也是 vue 3.0 最重要的一些新特性，例如 <code>setup()</code> 函数、<code>reactive()</code>、<code>ref()</code> 等这些 Vue Hooks。</p></blockquote><h2 id="基础要求"><a href="#基础要求" class="headerlink" title="基础要求"></a>基础要求</h2><ol><li>了解常见的 ES6 新特性<ul><li>ES6 的导入导出语法</li><li>解构赋值</li><li>箭头函数</li><li>etc…</li></ul></li><li>了解 vue 2.x 的基本使用<ul><li>组件</li><li>常用的指令</li><li>生命周期函数</li><li>computed、watch、ref 等</li></ul></li></ol><h2 id="相关资源"><a href="#相关资源" class="headerlink" title="相关资源"></a>相关资源</h2><ul><li>【github - <a target="_blank" rel="noopener" href="https://github.com/vuejs">vuejs</a>&#x2F;composition-api】<a target="_blank" rel="noopener" href="https://github.com/vuejs/composition-api">https://github.com/vuejs/composition-api</a></li><li>【github - <a target="_blank" rel="noopener" href="https://github.com/vuejs/composition-api">composition-api</a>&#x2F;CHANGELOG.md】<a target="_blank" rel="noopener" href="https://github.com/vuejs/composition-api/blob/master/CHANGELOG.md">https://github.com/vuejs/composition-api/blob/master/CHANGELOG.md</a></li></ul><h2 id="初始化项目"><a href="#初始化项目" class="headerlink" title="初始化项目"></a>初始化项目</h2><ol><li>安装 vue-cli3</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install -g @vue/cli</span><br><span class="line"># OR</span><br><span class="line">yarn global add @vue/cli</span><br></pre></td></tr></table></figure><ol start="2"><li>创建项目</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vue create my-project</span><br><span class="line"># OR</span><br><span class="line">vue ui</span><br></pre></td></tr></table></figure><ol start="3"><li>在项目中安装 <code>composition-api</code> 体验 vue3 新特性</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install @vue/composition-api --save</span><br><span class="line"># OR</span><br><span class="line">yarn add @vue/composition-api</span><br></pre></td></tr></table></figure><ol start="4"><li>在使用任何 <code>@vue/composition-api</code> 提供的能力前，必须先通过 <code>Vue.use()</code> 进行安装</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import Vue from &#x27;vue&#x27;</span><br><span class="line">import VueCompositionApi from &#x27;@vue/composition-api&#x27;</span><br><span class="line"></span><br><span class="line">Vue.use(VueCompositionApi)</span><br></pre></td></tr></table></figure><p>安装插件后，您就可以使用新的 <a target="_blank" rel="noopener" href="https://vue-composition-api-rfc.netlify.com/">Composition API</a> 来开发组件了。</p><h2 id="setup"><a href="#setup" class="headerlink" title="setup"></a>setup</h2><p><code>setup()</code> 函数是 vue3 中，专门为组件提供的新属性。它为我们使用 vue3 的 <code>Composition API</code> 新特性提供了统一的入口。</p><h3 id="执行时机"><a href="#执行时机" class="headerlink" title="执行时机"></a>执行时机</h3><p>setup 函数会在 beforeCreate 之后、created 之前执行</p><h3 id="接收-props-数据"><a href="#接收-props-数据" class="headerlink" title="接收 props 数据"></a>接收 props 数据</h3><ol><li>在 <code>props</code> 中定义当前组件允许外界传递过来的参数名称：</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">props: &#123;</span><br><span class="line"> p1: String</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>通过 <code>setup</code> 函数的第一个形参，接收 <code>props</code> 数据：</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">setup(props) &#123;</span><br><span class="line">   console.log(props.p1)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="context"><a href="#context" class="headerlink" title="context"></a>context</h3><p><code>setup</code> 函数的第二个形参是一个上下文对象，这个上下文对象中包含了一些有用的属性，这些属性在 <code>vue 2.x</code> 中需要通过 <code>this</code> 才能访问到，在 <code>vue 3.x</code> 中，它们的访问方式如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const MyComponent = &#123;</span><br><span class="line">  setup(props, context) &#123;</span><br><span class="line">    context.attrs</span><br><span class="line">    context.slots</span><br><span class="line">    context.parent</span><br><span class="line">    context.root</span><br><span class="line">    context.emit</span><br><span class="line">    context.refs</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注意：在 <code>setup()</code> 函数中无法访问到 <code>this</code></p></blockquote><h2 id="reactive"><a href="#reactive" class="headerlink" title="reactive"></a>reactive</h2><p><code>reactive()</code> 函数接收一个普通对象，返回一个响应式的数据对象。</p><h3 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h3><p>等价于 <code>vue 2.x</code> 中的 <code>Vue.observable()</code> 函数，<code>vue 3.x</code> 中提供了 <code>reactive()</code> 函数，用来创建响应式的数据对象，基本代码示例如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import &#123; reactive &#125; from &#x27;@vue/composition-api&#x27;</span><br><span class="line"></span><br><span class="line">// 创建响应式数据对象，得到的 state 类似于 vue 2.x 中 data() 返回的响应式对象</span><br><span class="line">const state = reactive(&#123; count: 0 &#125;)</span><br></pre></td></tr></table></figure><h3 id="定义响应式数据供-template-使用"><a href="#定义响应式数据供-template-使用" class="headerlink" title="定义响应式数据供 template 使用"></a>定义响应式数据供 template 使用</h3><ol><li>按需导入 <code>reactive</code> 函数：</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import &#123; reactive &#125; from &#x27;@vue/composition-api&#x27;</span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>setup()</code> 函数中调用 <code>reactive()</code> 函数，创建响应式数据对象：</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">setup() &#123;</span><br><span class="line">    // 创建响应式数据对象</span><br><span class="line">   const state = reactive(&#123;count: 0&#125;)</span><br><span class="line"></span><br><span class="line">    // setup 函数中将响应式数据对象 return 出去，供 template 使用</span><br><span class="line">   return state</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>在 <code>template</code> 中访问响应式数据：</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;当前的 count 值为：&#123;&#123;count&#125;&#125;&lt;/p&gt;</span><br></pre></td></tr></table></figure><h2 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h2><h3 id="基本语法-1"><a href="#基本语法-1" class="headerlink" title="基本语法"></a>基本语法</h3><p><code>ref()</code> 函数用来根据给定的值创建一个响应式的数据对象，<code>ref()</code> 函数调用的返回值是一个对象，这个对象上只包含一个 <code>.value</code> 属性：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import &#123; ref &#125; from &#x27;@vue/composition-api&#x27;</span><br><span class="line"></span><br><span class="line">// 创建响应式数据对象 count，初始值为 0</span><br><span class="line">const count = ref(0)</span><br><span class="line"></span><br><span class="line">// 如果要访问 ref() 创建出来的响应式数据对象的值，必须通过 .value 属性才可以</span><br><span class="line">console.log(count.value) // 输出 0</span><br><span class="line">// 让 count 的值 +1</span><br><span class="line">count.value++</span><br><span class="line">// 再次打印 count 的值</span><br><span class="line">console.log(count.value) // 输出 1</span><br></pre></td></tr></table></figure><h3 id="在-template-中访问-ref-创建的响应式数据"><a href="#在-template-中访问-ref-创建的响应式数据" class="headerlink" title="在 template 中访问 ref 创建的响应式数据"></a>在 template 中访问 ref 创建的响应式数据</h3><ol><li>在 <code>setup()</code> 中创建响应式数据：</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import &#123; ref &#125; from &#x27;@vue/composition-api&#x27;</span><br><span class="line"></span><br><span class="line">setup() &#123;</span><br><span class="line">   const count = ref(0)</span><br><span class="line"></span><br><span class="line">    return &#123;</span><br><span class="line">        count,</span><br><span class="line">        name: ref(&#x27;zs&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>在 <code>template</code> 中访问响应式数据：</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line"> &lt;p&gt;&#123;&#123;count&#125;&#125; --- &#123;&#123;name&#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h3 id="在-reactive-对象中访问-ref-创建的响应式数据"><a href="#在-reactive-对象中访问-ref-创建的响应式数据" class="headerlink" title="在 reactive 对象中访问 ref 创建的响应式数据"></a>在 reactive 对象中访问 ref 创建的响应式数据</h3><p>当把 <code>ref()</code> 创建出来的响应式数据对象，挂载到 <code>reactive()</code> 上时，会自动把响应式数据对象展开为原始的值，不需通过 <code>.value</code> 就可以直接被访问，例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const count = ref(0)</span><br><span class="line">const state = reactive(&#123;</span><br><span class="line">  count</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">console.log(state.count) // 输出 0</span><br><span class="line">state.count++ // 此处不需要通过 .value 就能直接访问原始值</span><br><span class="line">console.log(count) // 输出 1</span><br></pre></td></tr></table></figure><blockquote><p>注意：新的 ref 会覆盖旧的 ref，示例代码如下：</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// 创建 ref 并挂载到 reactive 中</span><br><span class="line">const c1 = ref(0)</span><br><span class="line">const state = reactive(&#123;</span><br><span class="line">  c1</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 再次创建 ref，命名为 c2</span><br><span class="line">const c2 = ref(9)</span><br><span class="line">// 将 旧 ref c1 替换为 新 ref c2</span><br><span class="line">state.c1 = c2</span><br><span class="line">state.c1++</span><br><span class="line"></span><br><span class="line">console.log(state.c1) // 输出 10</span><br><span class="line">console.log(c2.value) // 输出 10</span><br><span class="line">console.log(c1.value) // 输出 0</span><br></pre></td></tr></table></figure><h2 id="isRef"><a href="#isRef" class="headerlink" title="isRef"></a>isRef</h2><p><code>isRef()</code> 用来判断某个值是否为 <code>ref()</code> 创建出来的对象；应用场景：当需要展开某个可能为 <code>ref()</code> 创建出来的值的时候，例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import &#123; isRef &#125; from &#x27;@vue/composition-api&#x27;</span><br><span class="line"></span><br><span class="line">const unwrapped = isRef(foo) ? foo.value : foo</span><br></pre></td></tr></table></figure><h2 id="toRefs"><a href="#toRefs" class="headerlink" title="toRefs"></a>toRefs</h2><p><code>toRefs()</code> 函数可以将 <code>reactive()</code> 创建出来的响应式对象，转换为普通的对象，只不过，这个对象上的每个属性节点，都是 <code>ref()</code> 类型的响应式数据，最常见的应用场景如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">import &#123; toRefs &#125; from &#x27;@vue/composition-api&#x27;</span><br><span class="line"></span><br><span class="line">setup() &#123;</span><br><span class="line">    // 定义响应式数据对象</span><br><span class="line">    const state = reactive(&#123;</span><br><span class="line">      count: 0</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    // 定义页面上可用的事件处理函数</span><br><span class="line">    const increment = () =&gt; &#123;</span><br><span class="line">      state.count++</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 在 setup 中返回一个对象供页面使用</span><br><span class="line">    // 这个对象中可以包含响应式的数据，也可以包含事件处理函数</span><br><span class="line">    return &#123;</span><br><span class="line">      // 将 state 上的每个属性，都转化为 ref 形式的响应式数据</span><br><span class="line">      ...toRefs(state),</span><br><span class="line">      // 自增的事件处理函数</span><br><span class="line">      increment</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>页面上可以直接访问 <code>setup()</code> 中 return 出来的响应式数据：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;p&gt;当前的count值为：&#123;&#123;count&#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;button @click=&quot;increment&quot;&gt;+1&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h2 id="computed"><a href="#computed" class="headerlink" title="computed"></a>computed</h2><p><code>computed()</code> 用来创建计算属性，<code>computed()</code> 函数的返回值是一个 <code>ref</code> 的实例。使用 <code>computed</code> 之前需要按需导入：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import &#123; computed &#125; from &#x27;@vue/composition-api&#x27;</span><br></pre></td></tr></table></figure><h3 id="创建只读的计算属性"><a href="#创建只读的计算属性" class="headerlink" title="创建只读的计算属性"></a>创建只读的计算属性</h3><p>在调用 <code>computed()</code> 函数期间，传入一个 <code>function</code> 函数，可以得到一个只读的计算属性，示例代码如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// 创建一个 ref 响应式数据</span><br><span class="line">const count = ref(1)</span><br><span class="line"></span><br><span class="line">// 根据 count 的值，创建一个响应式的计算属性 plusOne</span><br><span class="line">// 它会根据依赖的 ref 自动计算并返回一个新的 ref</span><br><span class="line">const plusOne = computed(() =&gt; count.value + 1)</span><br><span class="line"></span><br><span class="line">console.log(plusOne.value) // 输出 2</span><br><span class="line">plusOne.value++ // error</span><br></pre></td></tr></table></figure><h3 id="创建可读可写的计算属性"><a href="#创建可读可写的计算属性" class="headerlink" title="创建可读可写的计算属性"></a>创建可读可写的计算属性</h3><p>在调用 <code>computed()</code> 函数期间，传入一个包含 <code>get</code> 和 <code>set</code> 函数的对象，可以得到一个可读可写的计算属性，示例代码如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// 创建一个 ref 响应式数据</span><br><span class="line">const count = ref(1)</span><br><span class="line"></span><br><span class="line">// 创建一个 computed 计算属性</span><br><span class="line">const plusOne = computed(&#123;</span><br><span class="line">  // 取值函数</span><br><span class="line">  get: () =&gt; count.value + 1,</span><br><span class="line">  // 赋值函数</span><br><span class="line">  set: val =&gt; &#123;</span><br><span class="line">    count.value = val - 1</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 为计算属性赋值的操作，会触发 set 函数</span><br><span class="line">plusOne.value = 9</span><br><span class="line">// 触发 set 函数后，count 的值会被更新</span><br><span class="line">console.log(count.value) // 输出 8</span><br></pre></td></tr></table></figure><h2 id="watch"><a href="#watch" class="headerlink" title="watch"></a>watch</h2><p><code>watch()</code> 函数用来监视某些数据项的变化，从而触发某些特定的操作，使用之前需要按需导入：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; watch &#125; <span class="keyword">from</span> <span class="string">&#x27;@vue/composition-api&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">const count = ref(0)</span><br><span class="line"></span><br><span class="line">// 定义 watch，只要 count 值变化，就会触发 watch 回调</span><br><span class="line">// watch 会在创建时会自动调用一次</span><br><span class="line">watch(() =&gt; console.log(count.value))</span><br><span class="line">// 输出 0</span><br><span class="line"></span><br><span class="line">setTimeout(() =&gt; &#123;</span><br><span class="line">  count.value++</span><br><span class="line">  // 输出 1</span><br><span class="line">&#125;, 1000)</span><br></pre></td></tr></table></figure><h3 id="监视指定的数据源"><a href="#监视指定的数据源" class="headerlink" title="监视指定的数据源"></a>监视指定的数据源</h3><p>监视 <code>reactive</code> 类型的数据源：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// 定义数据源</span><br><span class="line">const state = reactive(&#123; count: 0 &#125;)</span><br><span class="line">// 监视 state.count 这个数据节点的变化</span><br><span class="line">watch(</span><br><span class="line">  () =&gt; state.count,</span><br><span class="line">  (count, prevCount) =&gt; &#123;</span><br><span class="line">    /* ... */</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>监视 <code>ref</code> 类型的数据源：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 定义数据源</span><br><span class="line">const count = ref(0)</span><br><span class="line">// 指定要监视的数据源</span><br><span class="line">watch(count, (count, prevCount) =&gt; &#123;</span><br><span class="line">  /* ... */</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="监视多个数据源"><a href="#监视多个数据源" class="headerlink" title="监视多个数据源"></a>监视多个数据源</h3><p>监视 <code>reactive</code> 类型的数据源：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">const state = reactive(&#123; count: 0, name: &#x27;zs&#x27; &#125;)</span><br><span class="line"></span><br><span class="line">watch(</span><br><span class="line">  [() =&gt; state.count, () =&gt; state.name], // Object.values(toRefs(state)),</span><br><span class="line">  ([count, name], [prevCount, prevName]) =&gt; &#123;</span><br><span class="line">    console.log(count) // 新的 count 值</span><br><span class="line">    console.log(name) // 新的 name 值</span><br><span class="line">    console.log(&#x27;------------&#x27;)</span><br><span class="line">    console.log(prevCount) // 旧的 count 值</span><br><span class="line">    console.log(prevName) // 新的 name 值</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    lazy: true // 在 watch 被创建的时候，不执行回调函数中的代码</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">setTimeout(() =&gt; &#123;</span><br><span class="line">  state.count++</span><br><span class="line">  state.name = &#x27;ls&#x27;</span><br><span class="line">&#125;, 1000)</span><br></pre></td></tr></table></figure><p>监视 <code>ref</code> 类型的数据源：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">const count = ref(0)</span><br><span class="line">const name = ref(&#x27;zs&#x27;)</span><br><span class="line"></span><br><span class="line">watch(</span><br><span class="line">  [count, name], // 需要被监视的多个 ref 数据源</span><br><span class="line">  ([count, name], [prevCount, prevName]) =&gt; &#123;</span><br><span class="line">    console.log(count)</span><br><span class="line">    console.log(name)</span><br><span class="line">    console.log(&#x27;-------------&#x27;)</span><br><span class="line">    console.log(prevCount)</span><br><span class="line">    console.log(prevName)</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    lazy: true</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">setTimeout(() =&gt; &#123;</span><br><span class="line">  count.value++</span><br><span class="line">  name.value = &#x27;xiaomaolv&#x27;</span><br><span class="line">&#125;, 1000)</span><br></pre></td></tr></table></figure><h3 id="清除监视"><a href="#清除监视" class="headerlink" title="清除监视"></a>清除监视</h3><p>在 <code>setup()</code> 函数内创建的 <code>watch</code> 监视，会在当前组件被销毁的时候自动停止。如果想要明确地停止某个监视，可以调用 <code>watch()</code> 函数的返回值即可，语法如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 创建监视，并得到 停止函数</span><br><span class="line">const stop = watch(() =&gt; &#123;</span><br><span class="line">  /* ... */</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 调用停止函数，清除对应的监视</span><br><span class="line">stop()</span><br></pre></td></tr></table></figure><h3 id="在-watch-中清除无效的异步任务"><a href="#在-watch-中清除无效的异步任务" class="headerlink" title="在 watch 中清除无效的异步任务"></a>在 watch 中清除无效的异步任务</h3><p>有时候，当被 <code>watch</code> 监视的值发生变化时，或 <code>watch</code> 本身被 <code>stop</code> 之后，我们期望能够清除那些无效的异步任务，此时，<code>watch</code> 回调函数中提供了一个 <code>cleanup registrator function</code> 来执行清除的工作。这个清除函数会在如下情况下被调用：</p><ul><li>watch 被重复执行了</li><li>watch 被强制 <code>stop</code> 了</li></ul><p>Template 中的代码示例如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/* template 中的代码 */ &lt;input type=&quot;text&quot; v-model=&quot;keywords&quot; /&gt;</span><br></pre></td></tr></table></figure><p>Script 中的代码示例如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">// 定义响应式数据 keywords</span><br><span class="line">const keywords = ref(&#x27;&#x27;)</span><br><span class="line"></span><br><span class="line">// 异步任务：打印用户输入的关键词</span><br><span class="line">const asyncPrint = val =&gt; &#123;</span><br><span class="line">  // 延时 1 秒后打印</span><br><span class="line">  return setTimeout(() =&gt; &#123;</span><br><span class="line">    console.log(val)</span><br><span class="line">  &#125;, 1000)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 定义 watch 监听</span><br><span class="line">watch(</span><br><span class="line">  keywords,</span><br><span class="line">  (keywords, prevKeywords, onCleanup) =&gt; &#123;</span><br><span class="line">    // 执行异步任务，并得到关闭异步任务的 timerId</span><br><span class="line">    const timerId = asyncPrint(keywords)</span><br><span class="line"></span><br><span class="line">    // 如果 watch 监听被重复执行了，则会先清除上次未完成的异步任务</span><br><span class="line">    onCleanup(() =&gt; clearTimeout(timerId))</span><br><span class="line">  &#125;,</span><br><span class="line">  // watch 刚被创建的时候不执行</span><br><span class="line">  &#123; lazy: true &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">// 把 template 中需要的数据 return 出去</span><br><span class="line">return &#123;</span><br><span class="line">  keywords</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="LifeCycle-Hooks"><a href="#LifeCycle-Hooks" class="headerlink" title="LifeCycle Hooks"></a>LifeCycle Hooks</h2><p>新版的生命周期函数，可以按需导入到组件中，且只能在 <code>setup()</code> 函数中使用，代码示例如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import &#123; onMounted, onUpdated, onUnmounted &#125; from &#x27;@vue/composition-api&#x27;</span><br><span class="line"></span><br><span class="line">const MyComponent = &#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line">    onMounted(() =&gt; &#123;</span><br><span class="line">      console.log(&#x27;mounted!&#x27;)</span><br><span class="line">    &#125;)</span><br><span class="line">    onUpdated(() =&gt; &#123;</span><br><span class="line">      console.log(&#x27;updated!&#x27;)</span><br><span class="line">    &#125;)</span><br><span class="line">    onUnmounted(() =&gt; &#123;</span><br><span class="line">      console.log(&#x27;unmounted!&#x27;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>下面的列表，是 vue 2.x 的生命周期函数与新版 Composition API 之间的映射关系：</p><ul><li><del><code>beforeCreate</code></del> -&gt; use <code>setup()</code></li><li><del><code>created</code></del> -&gt; use <code>setup()</code></li><li><code>beforeMount</code> -&gt; <code>onBeforeMount</code></li><li><code>mounted</code> -&gt; <code>onMounted</code></li><li><code>beforeUpdate</code> -&gt; <code>onBeforeUpdate</code></li><li><code>updated</code> -&gt; <code>onUpdated</code></li><li><code>beforeDestroy</code> -&gt; <code>onBeforeUnmount</code></li><li><code>destroyed</code> -&gt; <code>onUnmounted</code></li><li><code>errorCaptured</code> -&gt; <code>onErrorCaptured</code></li></ul><h2 id="provide-inject"><a href="#provide-inject" class="headerlink" title="provide &amp; inject"></a>provide &amp; inject</h2><p><code>provide()</code> 和 <code>inject()</code> 可以实现嵌套组件之间的数据传递。这两个函数只能在 <code>setup()</code> 函数中使用。父级组件中使用 <code>provide()</code> 函数向下传递数据；子级组件中使用 <code>inject()</code> 获取上层传递过来的数据。</p><h3 id="共享普通数据"><a href="#共享普通数据" class="headerlink" title="共享普通数据"></a>共享普通数据</h3><p><code>App.vue</code> 根组件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=&quot;app&quot;&gt;</span><br><span class="line">    &lt;h1&gt;App 根组件&lt;/h1&gt;</span><br><span class="line">    &lt;hr /&gt;</span><br><span class="line">    &lt;LevelOne /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import LevelOne from &#x27;./components/LevelOne&#x27;</span><br><span class="line">// 1. 按需导入 provide</span><br><span class="line">import &#123; provide &#125; from &#x27;@vue/composition-api&#x27;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;app&#x27;,</span><br><span class="line">  setup() &#123;</span><br><span class="line">    // 2. App 根组件作为父级组件，通过 provide 函数向子级组件共享数据（不限层级）</span><br><span class="line">    //    provide(&#x27;要共享的数据名称&#x27;, 被共享的数据)</span><br><span class="line">    provide(&#x27;globalColor&#x27;, &#x27;red&#x27;)</span><br><span class="line">  &#125;,</span><br><span class="line">  components: &#123;</span><br><span class="line">    LevelOne</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p><code>LevelOne.vue</code> 组件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!-- 4. 通过属性绑定，为标签设置字体颜色 --&gt;</span><br><span class="line">    &lt;h3 :style=&quot;&#123;color: themeColor&#125;&quot;&gt;Level One&lt;/h3&gt;</span><br><span class="line">    &lt;hr /&gt;</span><br><span class="line">    &lt;LevelTwo /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import LevelTwo from &#x27;./LevelTwo&#x27;</span><br><span class="line">// 1. 按需导入 inject</span><br><span class="line">import &#123; inject &#125; from &#x27;@vue/composition-api&#x27;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line">    // 2. 调用 inject 函数时，通过指定的数据名称，获取到父级共享的数据</span><br><span class="line">    const themeColor = inject(&#x27;globalColor&#x27;)</span><br><span class="line"></span><br><span class="line">    // 3. 把接收到的共享数据 return 给 Template 使用</span><br><span class="line">    return &#123;</span><br><span class="line">      themeColor</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  components: &#123;</span><br><span class="line">    LevelTwo</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p><code>LevelTwo.vue</code> 组件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!-- 4. 通过属性绑定，为标签设置字体颜色 --&gt;</span><br><span class="line">    &lt;h5 :style=&quot;&#123;color: themeColor&#125;&quot;&gt;Level Two&lt;/h5&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">// 1. 按需导入 inject</span><br><span class="line">import &#123; inject &#125; from &#x27;@vue/composition-api&#x27;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line">    // 2. 调用 inject 函数时，通过指定的数据名称，获取到父级共享的数据</span><br><span class="line">    const themeColor = inject(&#x27;globalColor&#x27;)</span><br><span class="line"></span><br><span class="line">    // 3. 把接收到的共享数据 return 给 Template 使用</span><br><span class="line">    return &#123;</span><br><span class="line">      themeColor</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="共享-ref-响应式数据"><a href="#共享-ref-响应式数据" class="headerlink" title="共享 ref 响应式数据"></a>共享 ref 响应式数据</h3><p>如下代码实现了点按钮切换主题颜色的功能，主要修改了 <code>App.vue</code> 组件中的代码，<code>LevelOne.vue</code> 和 <code>LevelTwo.vue</code> 中的代码不受任何改变：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=&quot;app&quot;&gt;</span><br><span class="line">    &lt;h1&gt;App 根组件&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 点击 App.vue 中的按钮，切换子组件中文字的颜色 --&gt;</span><br><span class="line">    &lt;button @click=&quot;themeColor=&#x27;red&#x27;&quot;&gt;红色&lt;/button&gt;</span><br><span class="line">    &lt;button @click=&quot;themeColor=&#x27;blue&#x27;&quot;&gt;蓝色&lt;/button&gt;</span><br><span class="line">    &lt;button @click=&quot;themeColor=&#x27;orange&#x27;&quot;&gt;橘黄色&lt;/button&gt;</span><br><span class="line"></span><br><span class="line">    &lt;hr /&gt;</span><br><span class="line">    &lt;LevelOne /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import LevelOne from &#x27;./components/LevelOne&#x27;</span><br><span class="line">import &#123; provide, ref &#125; from &#x27;@vue/composition-api&#x27;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;app&#x27;,</span><br><span class="line">  setup() &#123;</span><br><span class="line">    // 定义 ref 响应式数据</span><br><span class="line">    const themeColor = ref(&#x27;red&#x27;)</span><br><span class="line"></span><br><span class="line">    // 把 ref 数据通过 provide 提供的子组件使用</span><br><span class="line">    provide(&#x27;globalColor&#x27;, themeColor)</span><br><span class="line"></span><br><span class="line">    // setup 中 return 数据供当前组件的 Template 使用</span><br><span class="line">    return &#123;</span><br><span class="line">      themeColor</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  components: &#123;</span><br><span class="line">    LevelOne</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h2 id="template-refs"><a href="#template-refs" class="headerlink" title="template refs"></a>template refs</h2><p>通过 <code>ref()</code> 还可以引用页面上的元素或组件。</p><h3 id="元素的引用"><a href="#元素的引用" class="headerlink" title="元素的引用"></a>元素的引用</h3><p>示例代码如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;h3 ref=&quot;h3Ref&quot;&gt;TemplateRefOne&lt;/h3&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; ref, onMounted &#125; from &#x27;@vue/composition-api&#x27;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line">    // 创建一个 DOM 引用</span><br><span class="line">    const h3Ref = ref(null)</span><br><span class="line"></span><br><span class="line">    // 在 DOM 首次加载完毕之后，才能获取到元素的引用</span><br><span class="line">    onMounted(() =&gt; &#123;</span><br><span class="line">      // 为 dom 元素设置字体颜色</span><br><span class="line">      // h3Ref.value 是原生DOM对象</span><br><span class="line">      h3Ref.value.style.color = &#x27;red&#x27;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    // 把创建的引用 return 出去</span><br><span class="line">    return &#123;</span><br><span class="line">      h3Ref</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="组件的引用"><a href="#组件的引用" class="headerlink" title="组件的引用"></a>组件的引用</h3><p><code>TemplateRefOne.vue</code> 中的示例代码如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;h3&gt;TemplateRefOne&lt;/h3&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 4. 点击按钮展示子组件的 count 值 --&gt;</span><br><span class="line">    &lt;button @click=&quot;showNumber&quot;&gt;获取TemplateRefTwo中的count值&lt;/button&gt;</span><br><span class="line"></span><br><span class="line">    &lt;hr /&gt;</span><br><span class="line">    &lt;!-- 3. 为组件添加 ref 引用 --&gt;</span><br><span class="line">    &lt;TemplateRefTwo ref=&quot;comRef&quot; /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;@vue/composition-api&#x27;</span><br><span class="line">import TemplateRefTwo from &#x27;./TemplateRefTwo&#x27;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line">    // 1. 创建一个组件的 ref 引用</span><br><span class="line">    const comRef = ref(null)</span><br><span class="line"></span><br><span class="line">    // 5. 展示子组件中 count 的值</span><br><span class="line">    const showNumber = () =&gt; &#123;</span><br><span class="line">      console.log(comRef.value.count)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 2. 把创建的引用 return 出去</span><br><span class="line">    return &#123;</span><br><span class="line">      comRef,</span><br><span class="line">      showNumber</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  components: &#123;</span><br><span class="line">    TemplateRefTwo</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p><code>TemplateRefTwo.vue</code> 中的示例代码：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">h5</span>&gt;</span>TemplateRefTwo --- &#123;&#123;count&#125;&#125;<span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- 3. 点击按钮，让 count 值自增 +1 --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;count+=1&quot;</span>&gt;</span>+1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;@vue/composition-api&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 1. 定义响应式的数据</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 2. 把响应式数据 return 给 Template 使用</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      count</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h2 id="createComponent"><a href="#createComponent" class="headerlink" title="createComponent"></a>createComponent</h2><blockquote><p>这个函数不是必须的，除非你想要完美结合 TypeScript 提供的类型推断来进行项目的开发。</p></blockquote><p>这个函数仅仅提供了类型推断，方便在结合 TypeScript 书写代码时，能为 <code>setup()</code> 中的 <code>props</code> 提供完整的类型推断。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import &#123; createComponent &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">export default createComponent(&#123;</span><br><span class="line">  props: &#123;</span><br><span class="line">    foo: String</span><br><span class="line">  &#125;,</span><br><span class="line">  setup(props) &#123;</span><br><span class="line">    props.foo // &lt;- type: string</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p></p></div><hr class="layui-border-orange"></div></div><style>.layui-content table{border-collapse:collapse;border-spacing:0;margin:10px 0;display:table}.layui-content table td,table th{padding:10px;border:1px solid #ddd;color:#333;vertical-align:middle;word-break:normal!important}.layui-content table .gutter{display:none}.layui-content figure.highlight{margin:15px 0;background:#e3e3e3;padding:0;line-height:24px;overflow-x:auto}.layui-content figure.highlight table td{border:0}.layui-content blockquote{margin:15px 0;background:#e3e3e3;border-left:3px solid #5fb878;padding:10px 0 0 20px}.layui-content ol li{margin-bottom:10px;list-style:decimal;margin-left:10px}.layui-content ul li{margin-bottom:10px;list-style:inside;margin-left:10px}.layui-content code{background-color:#e3e3e3}.layui-content a{text-decoration:underline;color:#1e9fff}body img{max-width:100%}</style></div></div></div><div class="footer"><p><span>Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> </span><span>| </span><span>Theme - <a href="https://github.com/zzqqw/hexo-theme-xianxin" target="_blank">xianxin</a></span></p><p><span>&copy; 2024</span> <span>MIT license</span></p><script async src="https://www.googletagmanager.com/gtag/js?id=G-TBH6G20B8Y"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-TBH6G20B8Y")</script></div></body></html>